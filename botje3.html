<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elektramat Chat</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');
        
        /* Namespace all chatbot styles to prevent Magento conflicts */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Open Sans','Segoe UI',Arial,sans-serif;font-size:16px;line-height:26px;color:#424140}
        #chat-toggle{position:fixed;bottom:20px;right:20px;width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#196CAE,#34BBDA);border:none;cursor:pointer;box-shadow:0 4px 12px rgba(25,108,174,.3);z-index:1000;display:flex;align-items:center;justify-content:center;transition:transform .3s}
        #chat-toggle:hover{transform:scale(1.1)}
        #chat-toggle svg{width:30px;height:30px;fill:white}
        #chat-toggle.has-new-message{animation:pulse-badge 2s infinite}
        @keyframes pulse-badge{0%,100%{box-shadow:0 4px 12px rgba(25,108,174,.3)}50%{box-shadow:0 4px 20px rgba(255,59,48,.8)}}
        #chat-badge{position:absolute;top:-5px;right:-5px;width:22px;height:22px;background:#FF3B30;border-radius:50%;display:none;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:white;border:2px solid white;animation:bounce-in .3s}
        @keyframes bounce-in{0%{transform:scale(0)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
        #pending-indicator{display:none;background:#fff3e0;color:#e65100;padding:8px 16px;font-size:12px;text-align:center;border-bottom:1px solid #ffe0b2}
        #chat-container{position:fixed;bottom:90px;right:20px;width:420px;height:650px;min-width:320px;min-height:400px;max-width:90vw;max-height:calc(100vh - 120px);background:white;border-radius:16px;box-shadow:0 8px 32px rgba(0,0,0,.15);display:none;flex-direction:column;overflow:hidden;z-index:999;transition:all .3s ease}
        #chat-container.active{display:flex;bottom:20px;height:720px;max-height:calc(100vh - 40px)}
        #chat-container.fullscreen{width:100vw!important;height:100vh!important;top:0!important;left:0!important;right:0!important;bottom:0!important;border-radius:0;max-height:100vh}
        .resize-handle{position:absolute;bottom:0;left:0;width:20px;height:20px;cursor:nwse-resize;z-index:10}
        .resize-handle::after{content:'';position:absolute;bottom:2px;left:2px;width:12px;height:12px;background:linear-gradient(-135deg,transparent 50%,#999 50%);border-bottom-left-radius:16px}
        #chat-container.fullscreen .resize-handle{display:none}
        #chat-header{background:linear-gradient(135deg,#196CAE,#34BBDA);color:white;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;position:relative}
        #chat-header::after{content:'';position:absolute;bottom:-10px;right:20px;width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;border-top:10px solid #34BBDA}
        .header-content{display:flex;align-items:center;gap:0;flex:1}
        .header-title{font-size:18px!important;font-weight:700!important;margin:0!important;letter-spacing:0.3px!important;color:white!important;text-shadow:0 1px 3px rgba(0,0,0,0.3)!important}
        .header-actions{display:flex;gap:8px;align-items:center}
        .header-btn{background:rgba(255,255,255,.2)!important;border:none!important;color:white!important;cursor:pointer!important;font-size:18px!important;padding:8px!important;border-radius:6px!important;transition:background .2s!important;width:36px!important;height:36px!important;display:flex!important;align-items:center!important;justify-content:center!important}
        .header-btn:hover{background:rgba(255,255,255,.3)!important}
        .header-btn:active{background:rgba(255,255,255,.4)!important}
        #hamburger-menu{position:absolute;top:56px;right:10px;background:white;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.2);padding:0;min-width:220px;display:none;z-index:1001}
        #hamburger-menu.active{display:block}
        .menu-section{padding:0}
        .menu-section-title{font-size:11px;font-weight:600;color:#666;padding:12px 16px 8px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e0e0e0}
        .menu-item{display:flex;align-items:center;gap:10px;padding:12px 16px;cursor:pointer;transition:background .2s;color:#424140;font-size:14px;border:none;background:none;width:100%;text-align:left}
        .menu-item:hover{background:#f5f5f5}
        .menu-item.active{background:#E9F8FB;color:#196CAE;font-weight:600}
        .menu-item .icon{font-size:16px;width:20px;text-align:center}
        .menu-divider{height:1px;background:#e0e0e0;margin:0}
        #chat-messages{flex:1;overflow-y:auto;padding:20px;background:#E9F8FB;display:flex;flex-direction:column;gap:12px}
        .message{max-width:80%!important;padding:12px 16px!important;border-radius:12px!important;word-wrap:break-word!important;animation:slideIn .3s!important;font-family:'Open Sans','Segoe UI',Arial,sans-serif!important;box-sizing:border-box!important}
        @keyframes slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .message.user{background:#34BBDA!important;color:white!important;align-self:flex-end!important;border-bottom-right-radius:4px!important}
        .message.bot{background:white!important;color:#424140!important;align-self:flex-start;border-bottom-left-radius:4px;box-shadow:0 2px 4px rgba(0,0,0,.05);white-space:pre-wrap!important;font-family:'Open Sans','Segoe UI',Arial,sans-serif!important;line-height:1.8!important;padding:12px 16px!important;display:block!important;word-wrap:break-word!important;overflow-wrap:break-word!important}
        .message.bot *{font-family:'Open Sans','Segoe UI',Arial,sans-serif!important;line-height:1.8!important}
        .message.bot strong{font-weight:700!important;color:#196CAE!important;display:inline!important}
        .message.bot em{font-style:italic!important;display:inline!important}
        .message.bot a{color:#196CAE!important;text-decoration:underline!important;font-weight:600!important;display:inline!important}
        .message.bot a:hover{color:#34BBDA!important}
        .message.bot br{display:block!important;content:""!important;margin:0.5em 0!important}
        #chat-container.font-small .message{font-size:10px}
        #chat-container.font-medium .message{font-size:12px}
        #chat-container.font-large .message{font-size:14px}
        #chat-container.font-small #chat-input{font-size:10px}
        #chat-container.font-medium #chat-input{font-size:12px}
        #chat-container.font-large #chat-input{font-size:14px}
        .typing-indicator{display:none;align-self:flex-start;padding:12px 16px;background:white;border-radius:12px;border-bottom-left-radius:4px}
        .typing-indicator.active{display:block}
        .typing-dots{display:flex;gap:4px}
        .typing-dots span{width:8px;height:8px;background:#196CAE;border-radius:50%;animation:typing 1.4s infinite}
        .typing-dots span:nth-child(2){animation-delay:.2s}
        .typing-dots span:nth-child(3){animation-delay:.4s}
        @keyframes typing{0%,60%,100%{transform:translateY(0);opacity:.7}30%{transform:translateY(-10px);opacity:1}}
        #email-form{display:none;padding:20px;background:white;border-top:1px solid #e0e0e0}
        #email-form.active{display:block}
        #email-form label{display:block;margin-bottom:8px;font-weight:600;color:#196CAE}
        #email-form input{width:100%;padding:12px;border:2px solid #34BBDA;border-radius:8px;font-size:16px;margin-bottom:12px}
        #email-form button{width:100%;padding:12px;background:#70CC0A;color:white;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer}
        #chat-input-area{padding:16px 20px;background:white;border-top:1px solid #e0e0e0;display:none;position:relative}
        #chat-input-area.active{display:block}
        .input-wrapper{position:relative;display:flex;align-items:stretch}
        #file-upload-btn{position:absolute!important;left:12px!important;bottom:12px!important;background:transparent!important;border:none!important;color:#196CAE!important;padding:8px!important;cursor:pointer!important;display:flex!important;align-items:center!important;justify-content:center!important;z-index:5!important;transition:color .2s!important}
        #file-upload-btn:hover{color:#34BBDA!important}
        #file-upload-btn svg{width:20px!important;height:20px!important;fill:currentColor!important}
        #chat-input{width:100%;padding:14px 50px 14px 45px;border:2px solid #34BBDA;border-radius:8px;font-size:14px;font-family:'Open Sans','Segoe UI',Arial,sans-serif;max-height:200px;min-height:80px;line-height:1.5;resize:none;overflow-y:auto}
        .input-resize-handle{position:absolute;bottom:16px;left:20px;width:16px;height:16px;cursor:ns-resize;z-index:10}
        .input-resize-handle::after{content:'';position:absolute;bottom:0;left:0;width:100%;height:2px;background:#34BBDA;border-radius:2px}
        #send-btn{position:absolute!important;right:12px!important;bottom:12px!important;background:#70CC0A!important;color:white!important;border:none!important;padding:8px 16px!important;border-radius:6px!important;cursor:pointer!important;font-weight:600!important;font-size:14px!important;z-index:5!important;transition:background .2s!important}
        #send-btn:hover{background:#5db008!important}
        #send-btn:disabled{opacity:.5!important;cursor:not-allowed!important}
        #chat-footer{padding:12px 20px;background:#f8f8f8;text-align:center;font-size:12px;color:#424140;border-top:1px solid #e0e0e0}
        #chat-footer strong{color:#196CAE}
        .error-message{background:#ffebee;color:#c62828;padding:12px;border-radius:8px;margin:10px 20px;font-size:14px;display:none}
        .error-message.active{display:block}
        #debug-panel{position:fixed;bottom:10px;left:10px;background:rgba(0,0,0,.9);color:white;padding:15px;border-radius:8px;font-size:11px;max-width:350px;display:none;z-index:1001;max-height:400px;overflow-y:auto}
        #debug-toggle{position:fixed;bottom:10px;left:10px;background:#424140;color:white;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:11px;z-index:1002}
        #file-input{display:none}
        @media (max-width:480px){
            #chat-container{width:100%!important;height:100%!important;bottom:0!important;right:0!important;border-radius:0;max-height:100vh!important}
        }
        
        /* Extra hoge z-index voor Magento compatibility */
        #chat-toggle{z-index:9999}
        #chat-container{z-index:9998}
        #hamburger-menu{z-index:9999}
        #debug-panel{z-index:9997}
        #debug-toggle{z-index:9997}
    </style>
</head>
<body>
    <button id="debug-toggle" style="display:none;">Debug</button>
    <div id="debug-panel" style="display:none;">
        <strong>Debug Info:</strong><br>
        Chat ID: <span id="debug-chatid">-</span><br>
        Email: <span id="debug-email">-</span><br>
        <strong>Ingelogd: <span id="debug-loggedin" style="color:#70CC0A">-</span></strong><br>
        Cart ID: <span id="debug-cartid">-</span><br>
        <strong>Opgeslagen: <span id="debug-saved" style="color:#70CC0A">-</span></strong><br>
        <strong>Pagina: <span id="debug-pagetype" style="color:#34BBDA">-</span></strong><br>
        <strong>Webhook: <span id="debug-webhook" style="color:#70CC0A">productie</span></strong><br>
        <button onclick="refreshCartId()" style="width:100%;margin-top:8px;padding:6px;background:#34BBDA;border:none;color:white;cursor:pointer;border-radius:4px;font-size:11px">üîÑ Refresh Data</button>
        <hr style="margin:8px 0;border:0;border-top:1px solid rgba(255,255,255,.2)">
        <strong>Override:</strong><br>
        <input type="text" id="debug-cart-override" placeholder="Magento Cart ID" style="width:100%;margin-top:8px;padding:4px;font-size:11px">
        <button onclick="overrideCartId()" style="width:100%;margin-top:4px;padding:4px;background:#70CC0A;border:none;color:white;cursor:pointer;border-radius:4px;font-size:11px">Set Cart ID</button>
        <hr style="margin:8px 0;border:0;border-top:1px solid rgba(255,255,255,.2)">
        <strong>Webhook URL:</strong><br>
        <input type="text" id="debug-webhook-override" placeholder="Test webhook URL" style="width:100%;margin-top:8px;padding:4px;font-size:11px">
        <button onclick="overrideWebhookUrl()" style="width:100%;margin-top:4px;padding:4px;background:#ff9800;border:none;color:white;cursor:pointer;border-radius:4px;font-size:11px">Set Webhook URL</button>
        <button onclick="clearWebhookOverride()" style="width:100%;margin-top:4px;padding:4px;background:#f44336;border:none;color:white;cursor:pointer;border-radius:4px;font-size:11px">Reset naar Productie</button>
        <hr style="margin:8px 0;border:0;border-top:1px solid rgba(255,255,255,.2)">
        <strong>Last Request:</strong><br>
        <div id="debug-last-request" style="background:rgba(255,255,255,.1);padding:8px;border-radius:4px;margin-top:8px;font-size:10px;max-height:150px;overflow-y:auto">Geen requests</div>
    </div>

    <button id="chat-toggle" aria-label="Open chat">
        <svg viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/></svg>
        <span id="chat-badge">!</span>
    </button>

    <div id="chat-container" class="font-medium">
        <div id="test-mode-banner" style="display:none;background:#ff9800;color:white;padding:8px 16px;font-size:12px;font-weight:600;text-align:center;">
            ‚ö†Ô∏è TEST MODE - Verbonden met test webhook
        </div>
        <div id="pending-indicator">
            ‚è≥ Wachten op antwoord... Je kunt veilig navigeren, het antwoord wordt bewaard.
        </div>
        <div id="chat-header">
            <div class="header-content">
                <h3 class="header-title">Botje</h3>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="menu-btn" title="Menu">‚ò∞</button>
                <button class="header-btn" id="fullscreen-btn" title="Volledig scherm">‚õ∂</button>
                <button class="header-btn" id="close-chat" title="Sluiten">√ó</button>
            </div>
        </div>

        <div id="hamburger-menu">
            <div class="menu-section">
                <div class="menu-section-title">Lettergrootte</div>
                <button class="menu-item" id="menu-font-small">
                    <span class="icon">A-</span>
                    <span>Klein (10px)</span>
                </button>
                <button class="menu-item active" id="menu-font-medium">
                    <span class="icon">A</span>
                    <span>Normaal (12px)</span>
                </button>
                <button class="menu-item" id="menu-font-large">
                    <span class="icon">A+</span>
                    <span>Groot (14px)</span>
                </button>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-section">
                <button class="menu-item" id="menu-reload-cart">
                    <span class="icon">üõí</span>
                    <span>Winkelwagen herladen</span>
                </button>
                <button class="menu-item" id="menu-new-chat">
                    <span class="icon">‚Üª</span>
                    <span>Nieuwe chat starten</span>
                </button>
                <button class="menu-item" id="menu-clear-chat">
                    <span class="icon">üóëÔ∏è</span>
                    <span>Chat wissen</span>
                </button>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-section">
                <div class="menu-section-title">Info</div>
                <div class="menu-item" style="cursor:default;flex-direction:column;align-items:flex-start;gap:4px;">
                    <span style="font-weight:600;color:#196CAE;" id="menu-version">Botje</span>
                    <span style="font-size:11px;color:#666;">Elektramat Chat Assistant</span>
                    <span style="font-size:10px;color:#999;" id="menu-connection-status">Verbonden met productie</span>
                </div>
            </div>
        </div>

        <div id="chat-messages">
            <div class="message bot">Hallo! Welkom bij Elektramat. Hoe kan ik je helpen?</div>
        </div>

        <div class="error-message" id="error-message"></div>

        <div class="typing-indicator" id="typing-indicator">
            <div class="typing-dots"><span></span><span></span><span></span></div>
        </div>

        <div id="email-form" class="active">
            <label for="user-email">Wat is je e-mailadres?</label>
            <input type="email" id="user-email" placeholder="jouw@email.nl" required>
            <button id="email-submit">Start Chat</button>
        </div>

        <div id="chat-input-area">
            <div class="input-wrapper">
                <label for="file-input" id="file-upload-btn" title="Bestand uploaden">
                    <svg viewBox="0 0 24 24"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/></svg>
                </label>
                <input type="file" id="file-input" accept="image/*,.pdf,.doc,.docx,.txt">
                <textarea id="chat-input" placeholder="Typ je bericht..."></textarea>
                <button id="send-btn">Stuur</button>
            </div>
            <div class="input-resize-handle" id="input-resize-handle"></div>
        </div>

        <div id="chat-footer"><strong>ELEKTRAMAT</strong> Meer dan Elektra!</div>
        <div class="resize-handle" id="chat-resize-handle"></div>
    </div>
</body>
</html>
